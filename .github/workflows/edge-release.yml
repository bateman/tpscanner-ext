name: Edge Release

on:
  workflow_dispatch:

jobs:
    release:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set tag
              id: tag
              run: echo "manifest=$(jq -c . < manifest.firefox.json)" >> $GITHUB_ENV

            - name: Create Edge zip
              run: make build/chrome

            - name: Upload to the Edge Add-ons Store         
              uses: birchill/edge-addon-upload@v1
              with:
                access_token_url: ${{ secrets.EDGE_ACCESS_TOKEN_URL }}
                client_id: ${{ secrets.EDGE_CLIENT_ID }}
                client_secret: ${{ secrets.EDGE_CLIENT_SECRET }}
                product_id: mgiijnhdenbgibgdffibiigpmnkgmboc
                addon_file: build/chrome/TPscanner-ext-${{ fromJson(env.manifest).version }}.zip